{% extends "base.html" %}

{% block breadcrumbs %}
{{ block.super }} &raquo; <a href="{% url config:configs %}">My configurations</a> &raquo; <em>{{ config.name }}</em>
{% endblock %}

{% block content %}

<h1><em>{{ config.name }}</em></h1>

<form action="{% url build:enqueue config.pk %}" method="post">
<input type="submit" value="Build" style="font-size: 120%; float: left; font-weight: bold">
</form>

<form action="{% url config:edit config.pk %}" method="get">
<input type="submit" value="Edit" style="font-size: 120%; float: left">
</form>

<div style="clear: both"></div>

{% if config.builds.exists %}
<h3>Build history</h3>
<table cellpadding="5">
<tr>
  <th>#</th>
  <th>Enqueued/Built</th>
  <th>Status</th>
</tr>
{% for build in config.builds.all %}
<tr>
  <td>{{ build.pk }}</td>
  <td>
    {% if build.status == "waiting" or build.status == "building" %}
      {{ build.enqueued|timesince }} ago
    {% else %}
      {{ build.finished|timesince }} ago
    {% endif %}
  </td>
  <td>
    {% if build.status == "waiting" %}
      <em>Waiting for builder to become available..</em>
    {% endif %}

    {% if build.status == "building" %}
      <em>Building...</em> ({{ build.started|timesince }})
      <a href="{{ build.log_url}}">Log</a>
    {% endif %}

    {% if build.status == "failure" %}
      <strong>Build failed!</strong> 
      <a href="{{ build.log_url}}">Log</a>
    {% endif %}

    {% if build.status == "success" %}
      <strong>Finished.</strong>
      <a href="{{ build.result_url}}">Download</a>
      <a href="{{ build.log_url}}">Log</a>
    {% endif %}

  </td>
</tr>
{% endfor %}
</table>
{% endif %}

<p style="font-family: monospace">$ lh config {{ config.options|command_line_options }} &amp;&amp; sudo lh build</tt></p>

{% endblock %}
